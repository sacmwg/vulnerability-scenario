The strongswan.org XMPP-Grid Service
====================================


 XMPP-Grid Server
-----------------

The **strongswan.org** domain is running the
[Openfire 4.1.6](https://www.igniterealtime.org/projects/openfire/) XMPP server
**xmpp.strongswan.org** (46.126.238.39, listening on TCP port 5222). The
[XMPP-Grid](https://tools.ietf.org/html/draft-ietf-mile-xmpp-grid) service is
based on the XMPP **Publish-Subscribe** plugin
[XEP-0060](https://xmpp.org/extensions/xep-0060.html). **xmpp.strongswan.org**
authenticates itself with a server certificate issued by the
[strongSwan Root CA](./strongswanCaCert.pem).


XMPP-Grid Clients
-----------------

Any XMPP client supporting the XMPP
[Publish-Subscribe](https://xmpp.org/extensions/xep-0060.html)
protocol can be used to connect to the strongSwan XMPP server.
The [strongTNC](https://github.com/strongswan/strongTNC/tree/xmpp-grid) Endpoint Collector
e.g. uses the [SleekXMPP](https://github.com/fritzy/SleekXMPP) Python client.

The SleekXMPP Pubsub example client [pubsub_client.py](./pubsub_client.py)
can be used to discover existing topics (nodes)

    python pubsub_client.py -j <user>@strongswan.org pubsub.strongswan.org nodes

    - ('pubsub.strongswan.org', 'sacm/endpoints', 'Endpoints')
    - ('pubsub.strongswan.org', 'sacm/vulnerabilities', '')
    - ('pubsub.strongswan.org', 'sacm/swidtags', 'Software Identification Tags')
    - ('pubsub.strongswan.org', 'sacm/events', 'Events')
    - ('pubsub.strongswan.org', 'sacm', '')

The last cached item of the sacm/swidtags node is

    python pubsub_client.py -j <user>@strongswan.org pubsub.strongswan.org nodes sacm/swidtags

     - ('pubsub.strongswan.org', None, 'strongswan.org__Ubuntu_16.04-x86_64-wpasupplicant-2.4-0ubuntu6.2')

This item was published using the Pubsub example publisher [pubsub_publish.py](./pubsub_publish.py)

     python pubsub_publish.py -j tnc@strongswan.org pubsub.strongswan.org sacm/swidtags \
            strongswan.org__Ubuntu_16.04-x86_64-wpasupplicant-2.4-0ubuntu6.2 \
           "<SoftwareIdentity name=\"wpasupplicant\" tagId=\"Ubuntu_16.04-x86_64-wpasupplicant-2.4-0ubuntu6.2\" version=\"2.4-0ubuntu6.2\" versionScheme=\"alphanumeric\" xmlns=\"http://standards.iso.org/iso/19770/-2/2015/schema.xsd\" xmlns:n8060=\"http://csrc.nist.gov/schema/swid/2015-extensions/swid-2015-extensions-1.0.xsd\"><Entity name=\"strongSwan Project\" regid=\"strongswan.org\" role=\"tagCreator\" /><Meta product=\"Ubuntu 16.04 x86_64\" /></SoftwareIdentity>"

The user can retrieve the cached item with the command

    python pubsub_client.py -j <user>@strongswan.org pubsub.strongswan.org get sacm/swidtags strongswan.org__Ubuntu_16.04-x86_64-wpasupplicant-2.4-0ubuntu6.2

    Retrieved item strongswan.org__Ubuntu_16.04-x86_64-wpasupplicant-2.4-0ubuntu6.2:
    <SoftwareIdentity xmlns="http://standards.iso.org/iso/19770/-2/2015/schema.xsd" tagId="Ubuntu_16.04-x86_64-wpasupplicant-2.4-0ubuntu6.2" version="2.4-0ubuntu6.2" versionScheme="alphanumeric" name="wpasupplicant"><Entity regid="strongswan.org" role="tagCreator" name="strongSwan Project" /><Meta product="Ubuntu 16.04 x86_64" /></SoftwareIdentity>

The user can subscribe to a topic (node) with the command

    python pubsub_client.py -j <user>@strongswan.org pubsub.strongswan.org subscribe sacm/events

and check her subscriptions with the command

    python pubsub_client.py -j <user>@strongswan.org pubsub.strongswan.org subscriptions

    - sacm/events: subscribed
    - sacm/swidtags: subscribed

The node owner can list the users subscribed to the node with the command

    python pubsub_mgmt.py -j <owner>@strongswan.org pubsub.strongswan.org node_subscriptions sacm/events

    - x509@strongswan.org: subscribed
    - adam.montville@strongswan.org: subscribed
    - chris.inacio@strongswan.org: subscribed
    - danny.haynes@strongswan.org: subscribed
    - david.waltermire@strongswan.org: subscribed
    - henk.birkholz@strongswan.org: subscribed
    - ncamwing@strongswan.org: subscribed
    - stephen.banghart@strongswan.org: subscribed
    - william.munyan@strongswan.org: subscribed

The SleekXMPP Pubsub events example client [pubsub_events.py](./pubsub_events.py) can be
used to monitor Publish-Subscribe events:

    python pubsub_events.py -j <user>@strongswan.org pubsub.strongswan.org

An extensive log of Publish-Subscribe events can be found [here](./pubsub_events.xml).

Information on the Pubsub [features](./pubsub_features.xml) the XMPP-Server supports can
be retrieved with the command

    python pubsub_events.py -j <user>@strongswan.org pubsub.strongswan.org info

and information on the Pubsub [node](./pubsub_info_sacm_swidtags.xml) ``sacm/swidtags`` with

    python pubsub_events.py -j <user>@strongswan.org pubsub.strongswan.org info sacm/swidtags

The node owner can extract the [node configuration](./pubsub_node_config.xml) as
a [XEP-0004](https://xmpp.org/extensions/xep-0004.html) form with the command

    python pubsub_events.py -j <owner>@strongswan.org pubsub.strongswan.org node_config sacm/swidtags

With a quick-and-dirty hack of the [pubsub_client](./pubsub_client.py) source code, the configuration of the
node ``sacm/events``can be modified with the [XEP-0004](https://xmpp.org/extensions/xep-0004.html) form

    form = self['xep_0004'].make_form()
    form['type'] = 'submit'
    form.add_field(var='FORM_TYPE', ftype='hidden',
                   value='http://jabber.org/protocol/pubsub#node_config')
    form.add_field(var='pubsub#title', ftype='text-single', value='Events')
    form.add_field(var='pubsub#description', ftype='text-single',
                   value='Events collected from associated endpoints via SWIMA')
    form.add_field(var='pubsub#publisher', ftype='jid-multi',
                   value='adam.montville@strongswan.org\n' + \
                         'chris.inacio@strongswan.org\n' + \
                         'danny.haynes@strongswan.org\n' + \
                         'david.waltermire@strongswan.org\n' + \
                         'stephen.banghart@strongswan.org\n' + \
                         'william.munyan@strongswan.org\n' + \
                         'henk.birkholz@strongswan.org\n' + \
                         'ncamwing@strongswan.org')
    form.add_field(var='pubsub#persist_items', ftype='boolean', value='1')
    form.add_field(var='pubsub#max_items', ftype='text-single', value='2000')

IMPORTANT: Do not add the jid of the node owner to the list of publishers because then the owner will completely lose control of the node which can be re-established only by manually hacking Openfire's MySQL database!

The node configuration update is applied by the node owner with the command

    python pubsub_client.py -j <owner>@strongswan.org pubsub.strongswan.org config sacm/events

The node owner can list the affilations of a given node with the command

    python pubsub_client.py -j <owner>@strongswan.org pubsub.strongswan.org node_affiliations sacm/events

    - adam.montville@strongswan.org: publisher
    - chris.inacio@strongswan.org: publisher
    - danny.haynes@strongswan.org: publisher
    - david.waltermire@strongswan.org: publisher
    - henk.birkholz@strongswan.org: publisher
    - ncamwing@strongswan.org: publisher
    - stephen.banghart@strongswan.org: publisher
    - tnc@strongswan.org: owner
    - william.munjan@strongswan.org: publisher


XMPP-Grid strongTNC Publisher
-----------------------------

The [strongTNC](https://github.com/strongswan/strongTNC/tree/xmpp-grid) Endpoint Collector
currently publishes all newly imported SWID tags on the ``sacm/swidtags`` node and
all SWIMA events collected from the associated endpoints on the ``sacm/events`` node.


XMPP-Grid Topics
----------------

The following topics (nodes) have been defined:

- sacm
- sacm/endpoints
- sacm/events
- sacm/swidtags
- sacm/vulnerabilities


XMPP Users
----------

Currently XMPP user accounts of the form <user>@strongswan.org for the following
IETF 100 Hackathon participants have been created:

- adam.montville
- chris.inacio
- danny.haynes
- david.waltermire
- henk.birkholz
- ncamwing
- stephen.banghart
- william.munyan

The password for all accounts is "ietf100hackathon". All users have been subscribed
to the ``sacm/swidtags`` topic.
